title Tìm Kiếm Người Dùng - Sequence Diagram

frame "Tìm Kiếm Người Dùng"
actor Admin
boundary "Admin UI" as UI
boundary "SearchUserView (API)" as API
control "AuthManager" as AUTH
database "Database (MongoDB)" as DB

Admin->UI: Nhập từ khóa tìm kiếm\n(username, email hoặc user_id)
UI->API: GET /api/admin/search-users/\n(search_query, session_id)

API->AUTH: get_user_from_session(session_id)
AUTH->DB: Kiểm tra session và lấy user
alt Session không hợp lệ hoặc chưa đăng nhập
    DB-->AUTH: không tìm thấy session
    AUTH-->API: không tìm thấy user
    API-->UI: Response (success: false, message: "Vui lòng đăng nhập")
    UI-->Admin: Hiển thị thông báo lỗi yêu cầu đăng nhập
else Session hợp lệ
    DB-->AUTH: user object
    AUTH-->API: user object
    
    API->API: Kiểm tra quyền admin\n(user có role="admin" hoặc is_admin=true)
    alt Không có quyền admin
        API-->UI: Response (success: false, message: "Không có quyền truy cập")
        UI-->Admin: Hiển thị thông báo lỗi không có quyền
    else Có quyền admin
        API->API: Kiểm tra search_query có rỗng không
        alt Từ khóa tìm kiếm rỗng
            API-->UI: Response (success: false, message: "Vui lòng nhập từ khóa tìm kiếm")
            UI-->Admin: Hiển thị thông báo lỗi
        else Có từ khóa tìm kiếm
            API->DB: search_users(search_query)
            DB->DB: Tìm kiếm trong collection users\ntheo username, email hoặc user_id
            alt Không tìm thấy người dùng nào
                DB-->API: []
                API-->UI: Response (success: true, users: [], message: "Không tìm thấy người dùng nào")
                UI-->Admin: Hiển thị thông báo không tìm thấy
            else Tìm thấy người dùng
                DB-->API: list_users (danh sách user objects)
                API->API: Loại bỏ thông tin nhạy cảm\n(password_hash, ...)
                API->API: Format dữ liệu trả về
                API-->UI: Response (success: true, users: list_users, total: count)
                UI->UI: Hiển thị danh sách người dùng\ntrong bảng hoặc danh sách
                UI-->Admin: Hiển thị kết quả tìm kiếm\nvới thông tin người dùng
            end
        end
    end
end
end

