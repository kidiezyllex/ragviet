Mô tả chức năng: Chức năng gửi câu hỏi cho phép người dùng đặt câu hỏi về nội dung các tài liệu đã được upload vào hệ thống hoặc thực hiện các câu hỏi tự nhiên (chào hỏi, giới thiệu).
Trình tự thực hiện:
1. Người dùng nhập câu hỏi vào giao diện chat (Gradio UI) và gửi câu hỏi.
2. Giao diện (Gradio UI) gửi yêu cầu POST đến Backend API (ChatSendView) kèm theo thông tin câu hỏi, session_id và selected_file (nếu có).
3. Backend API tiến hành kiểm tra xem câu hỏi có phải là câu hỏi tự nhiên (chào hỏi, giới thiệu) hay không thông qua NaturalLanguage Processor.
4. NaturalLanguage Processor trả kết quả kiểm tra cho Backend API.
Trường hợp 1: Câu hỏi tự nhiên (chào, hello, giới thiệu, ...)
5. Backend API nhận được câu trả lời tự nhiên từ NaturalLanguage Processor.
6. Backend API tiến hành lưu câu hỏi và câu trả lời vào Database (MongoDB).
7. Database trả về kết quả lưu thành công cho Backend API.
8. Backend API trả về câu trả lời tự nhiên cho FrontEnd.
9. Giao diện hiển thị câu trả lời tự nhiên cho người dùng.
Trường hợp 2: Câu hỏi về tài liệu
5. Backend API nhận được kết quả None từ NaturalLanguage Processor (không phải câu hỏi tự nhiên).
6. Backend API gửi truy vấn tới VectorStore (FAISS) để kiểm tra số lượng tài liệu đã được upload.
7. VectorStore trả về thông tin thống kê tài liệu cho Backend API.
Trường hợp 2.1: Chưa có tài liệu
8. Backend API trả về thông báo "Chưa có tài liệu nào được upload" cho FrontEnd.
9. Giao diện hiển thị thông báo lỗi cho người dùng.
Trường hợp 2.2: Có tài liệu
8. Backend API gửi truy vấn tìm kiếm tới VectorStore (FAISS) với câu hỏi của người dùng, top_k=30 và filename (nếu có).
9. VectorStore trả về kết quả tìm kiếm (search_results) cho Backend API.
Trường hợp 2.2.1: Không tìm thấy kết quả
10. Backend API tiến hành lưu câu hỏi và thông báo "Không tìm thấy thông tin" vào Database.
11. Database trả về kết quả lưu thành công cho Backend API.
12. Backend API trả về thông báo "Không tìm thấy thông tin" cho FrontEnd.
13. Giao diện hiển thị thông báo không tìm thấy cho người dùng.
Trường hợp 2.2.2: Tìm thấy kết quả
10. Backend API gửi yêu cầu lấy các chunks liên quan (adjacent chunks) từ VectorStore với page_range=2 để mở rộng kết quả tìm kiếm.
11. VectorStore trả về danh sách chunks đã mở rộng (expanded_results) cho Backend API.
12. Backend API gửi yêu cầu rerank kết quả tìm kiếm tới Reranker để sắp xếp lại theo độ liên quan với câu hỏi, top_k=15.
13. Reranker trả về danh sách kết quả đã được sắp xếp lại (reranked_results) cho Backend API.
14. Backend API gửi yêu cầu sinh câu trả lời tới LLM Client (Groq) kèm theo câu hỏi và các chunks đã được rerank.
15. LLM Client tiến hành tạo prompt với context từ các chunks và gọi Groq API để sinh câu trả lời.
16. LLM Client trả về câu trả lời (answer) cho Backend API.
17. Backend API tiến hành lưu câu hỏi, câu trả lời và thông tin liên quan (user_id, selected_file, chat_session_id) vào Database.
18. Database trả về kết quả lưu thành công cho Backend API.
19. Nếu có chat_session_id, Backend API tiến hành cập nhật tiêu đề session với nội dung câu hỏi.
20. Database trả về kết quả cập nhật thành công cho Backend API.
21. Backend API trả về câu trả lời đầy đủ cho FrontEnd.
22. Giao diện hiển thị câu trả lời cho người dùng.
Kết quả: Quá trình gửi câu hỏi và nhận câu trả lời thành công. Câu hỏi và câu trả lời được lưu vào Database để lưu lịch sử chat.
