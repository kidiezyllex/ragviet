Mô tả chức năng: Chức năng upload tài liệu PDF cho phép người dùng đã đăng nhập tải lên một hoặc nhiều file PDF vào hệ thống. Hệ thống sẽ tự động trích xuất văn bản, chia nhỏ thành các chunks và lưu vào VectorStore (FAISS) để phục vụ tìm kiếm và trả lời câu hỏi.
Trình tự thực hiện:
1. Người dùng chọn một hoặc nhiều file PDF trong giao diện quản lý tài liệu (Gradio UI) và nhấn nút upload.
2. Giao diện (Gradio UI) gửi yêu cầu POST đến Backend API (FileUploadView) kèm theo danh sách file PDF và session_id.
3. Backend API gửi yêu cầu kiểm tra session tới AuthManager với session_id.
4. AuthManager gửi truy vấn kiểm tra session trong Database (MongoDB).
Trường hợp 1: Session không hợp lệ hoặc chưa đăng nhập
5. Database trả về kết quả None cho AuthManager.
6. AuthManager trả về kết quả None cho Backend API.
7. Backend API trả về thông báo "Vui lòng đăng nhập để upload file" cho FrontEnd.
8. Giao diện hiển thị thông báo lỗi yêu cầu đăng nhập cho người dùng.
Trường hợp 2: Session hợp lệ
5. Database trả về user object cho AuthManager.
6. AuthManager trả về user object cho Backend API.
7. Backend API tiến hành kiểm tra xem có file nào được gửi lên hay không.
Trường hợp 2.1: Không có file nào
8. Backend API trả về thông báo "Vui lòng chọn ít nhất một file PDF" cho FrontEnd.
9. Giao diện hiển thị thông báo lỗi cho người dùng.
Trường hợp 2.2: Có file
8. Backend API tiến hành kiểm tra từng file có phải là định dạng PDF hay không.
Trường hợp 2.2.1: Có file không phải PDF
9. Backend API trả về thông báo "File không phải là PDF" cho FrontEnd.
10. Giao diện hiển thị thông báo lỗi cho người dùng.
Trường hợp 2.2.2: Tất cả file đều là PDF
9. Backend API tiến hành lưu các file PDF vào File System (MEDIA_ROOT).
10. File System lưu file và trả về danh sách đường dẫn file (pdf_paths) cho Backend API.
11. Backend API gửi yêu cầu xử lý PDF tới PDFProcessor với danh sách đường dẫn file.
12. PDFProcessor tiến hành trích xuất văn bản từ từng file PDF (extract_text_from_pdf).
13. PDFProcessor tiến hành chia nhỏ văn bản thành các chunks với chunk_size=400 và overlap=100 (create_chunks).
Trường hợp 2.2.2.1: Không thể trích xuất văn bản
14. PDFProcessor trả về danh sách chunks rỗng cho Backend API.
15. Backend API trả về thông báo "Không thể trích xuất văn bản từ các file PDF" cho FrontEnd.
16. Giao diện hiển thị thông báo lỗi cho người dùng.
Trường hợp 2.2.2.2: Trích xuất thành công
14. PDFProcessor trả về danh sách chunks (all_chunks) và thông tin số trang (pages_info) cho Backend API.
15. Backend API gửi yêu cầu thêm documents vào VectorStore (FAISS) với danh sách chunks.
16. VectorStore tiến hành tạo embeddings cho từng chunk sử dụng embedding model.
17. VectorStore tiến hành lưu các vectors vào FAISS index.
18. VectorStore tiến hành lưu metadata (filename, page_number, chunk_id) vào file JSON.
19. VectorStore trả về kết quả thành công cho Backend API.
20. Backend API tiến hành tính toán tổng số trang và tạo summary chi tiết cho từng file.
21. Backend API trả về kết quả thành công kèm theo thông tin chi tiết (số file đã xử lý, tổng số trang, chi tiết từng file) cho FrontEnd.
22. Giao diện cập nhật danh sách file đã upload và hiển thị thông báo thành công cùng với thông tin chi tiết cho người dùng.
Kết quả: Quá trình upload và xử lý tài liệu PDF thành công. Các file PDF đã được trích xuất văn bản, chia nhỏ thành chunks và lưu vào VectorStore để phục vụ tìm kiếm và trả lời câu hỏi.

